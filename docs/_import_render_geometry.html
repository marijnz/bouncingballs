<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Gameplay Programming: Importing Rendering Geometry</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Gameplay Programming
   </div>
   <div id="projectbrief">Engine Usage Guide and API Documentation for the lecture 113522a &quot;Gameplay Programming&quot;, Stuttgart Media University.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Importing Rendering Geometry </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>General Notes </h1>
<ul>
<li>Your textures have to be in <b>DXT1 compressed DDS format</b>. The engine cannot load anything else than DDS and won't display anything else than DXT1 correctly. If you see only small stripes of your texture on your mesh, then you probably used DXT3 or DXT5, which won't work correctly.</li>
<li>It is recommended to use 3ds Max but it might still be possible that something like Blender might work as well.</li>
<li>We will be using the FBX format in this guide but it is also possible to use Collada or maybe even other formats. The <em>ModelConverterD</em> tool works best with the "FBX ASCII 2013" that 3ds Max produces, but does not work with the ASCII FBX format that Blender produces. You will probably need an ASCII version of your chosen format (be that FBX, DAE, etc...) because you have to adjust the paths to your textures since they have to be relative to the working directory of the engine.</li>
<li>Throughout this guide, we will use a folder <code>export</code> that lives on the same level as the Visual Studio solution file (<code>.sln</code>) and the <code>data</code> folder.</li>
<li>In 3ds Max, make sure that you use <b>Generic Units</b> in "Customize -&gt; Units Setup...", otherwise you will get weird scales.<ul>
<li><em>Note: Do <b>not</b> use meters!</em></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="ImportRenderGeometry_Requirements"></a>
Requirements </h1>
<ul>
<li>Autodesk 3ds Max<ul>
<li>We will be using the 64 bit version of 3ds Max 2013</li>
<li>It should be available for you for free since Autodesk offers an educational license for free.</li>
</ul>
</li>
<li>A converter that is able to convert an image file to DDS (DXT1) format<ul>
<li>If you have DirectX installed, you can use the <em>DirectX Texture Tool</em> located at <code>"%DXSDK_DIR%/Utilities/bin/x64/DxTex.exe"</code></li>
<li>There is a Photoshop plugin by nVidia</li>
<li>GIMP 2 also supports DDS out of the box</li>
<li>There are multiple online conversion tools, just google it. ;)</li>
</ul>
</li>
<li>The <em>ModelConverter</em> from <a href="ftp://mirror.mi.hdm-stuttgart.de/Gaming/GEP_GPP/Tools/">GEP/GPP Mirror</a></li>
</ul>
<h1>Creating and Exporting the Model </h1>
<p><em>If you already have a model, skip this section, but <b>make sure your model has UV mappings!</b></em></p>
<p>In this section, we are going to create a model that will represent our terrain. We will call the 3ds Max file <code>terrain.max</code> and save it in the export folder, where we also have the texture and model converter (check the corresponding sections below).</p>
<p>Start 3ds Max and you should have an empty scene. We will create the model in this scene. From the <code>Create</code> tab, make sure you are in the <code>Geometry</code> sub-tab and have the <code>Standard Primitives</code> selected in the drop-down menu. There, click on <code>Plane</code>. </p><div class="image">
<img src="ImportRenderGeometry_ChoosePlane.png" alt="ImportRenderGeometry_ChoosePlane.png"/>
</div>
<p>Create a 20m x 20m plane in the origin (so the face of the plane faces upwards) and set the <code>Length Segs</code> and <code>Width Segs</code> to something like 8 or higher. You can set these parameters in the <code>Modify</code> tab, once you created the plane. You may also name your plane object there, which is always a good idea because "Terrain" says a lot more about the purpose of the model than "Plane001". </p><div class="image">
<img src="ImportRenderGeometry_PlaneParams.png" alt="ImportRenderGeometry_PlaneParams.png"/>
</div>
<p>Having such a plain plane is kind of boring, so we distort it a bit using some modifiers. Apply the <code>Bend</code> modifier (from the drop-down menu <code>Modifier List</code>), set the <code>Angle</code> parameter to 45, the <code>Direction</code> parameter to 90, and choose the Y-Axis as the <code>Bend Axis</code>. </p><div class="image">
<img src="ImportRenderGeometry_Bend.png" alt="ImportRenderGeometry_Bend.png"/>
</div>
<p>Now we unwrap the whole thing and generate some UV-coordinates. At this point, it would be a good idea to have a texture ready. Your texture should be in DDS DXT1 format already (3ds Max can handle it). Refer to the next section to find out how to convert your texture.</p>
<p>Apply the <code>UVW Map</code> modifier from the <code>Modifier List</code> drop-down and open the Material Editor using the <code>M</code> key on your keyboard. In this window, drag and drop the <code>Standard</code> Material from the left-hand side to the center area. Do this with the <code>Bitmap</code> as well. You are prompted to choose a bitmap. Locate your DDS file and select it, then hit "Open". Connect circle on the right of the Bitmap node with the circle next to the "Diffuse Color" of the Material node. By the way, as always, its always a good idea to name thing according to their purpose, so you should go ahead and name the material nodes.</p>
<p>To see the material on your object in the scene, make sure it is selected and then press the <code>Assign Material to Selection</code> button (or press <code>A</code> on the keyboard). The icon for this button has a small spherical object on it, as well as a green cube and an arrow pointing from the former to the latter. If this button is grayed out, you have to make sure the <code>Show Shaded Material in Viewport</code> button is pressed as well. It looks like a small chessboard with a lamp on it. You can find these button in the toolbar at the top )second row). </p><div class="image">
<img src="ImportRenderGeometry_Material.png" alt="ImportRenderGeometry_Material.png"/>
</div>
<p>You can close the material editor because now we export the model. Make sure the model you want to export is selected, click on the 3ds Max button in the top left, click on the arrow next to "Export" and choose "Export Selected". Navigate to the export folder, enter <code>terrain.fbx</code> as the file name, and hit save. </p><div class="image">
<img src="ImportRenderGeometry_ExportSelected.png" alt="ImportRenderGeometry_ExportSelected.png"/>
</div>
<p>In the export options window that just popped up, there are a couple of things that you have to make sure are set:</p><ul>
<li>Up Axis is set to Z-Axis</li>
<li>"Units" is set to "Automatic"</li>
<li>The FBX File Format is "ASCII" "FBX 2013" <div class="image">
<img src="ImportRenderGeometry_ExportSettings.png" alt="ImportRenderGeometry_ExportSettings.png"/>
</div>
</li>
</ul>
<p><em>Note: You could also export as Collada (.DAE) but this is discouraged when using 3ds Max because the model converter likes FBX more. If you're using Blender, you have to use Collada, since the ModelConverter cannot handle the FBX ASCII format version that Blender produces.</em></p>
<p>And that is it! You should now head over to the section about model conversion.</p>
<h1>Converting a texture to DDS and DXT1 compression </h1>
<ul>
<li>Start the <em>DirectX Texture Tool</em> located at <code>"%DXSDK_DIR%/Utilities/bin/x64/DxTex.exe"</code>.</li>
<li>Click on "File" -&gt; "Open" and locate your texture.</li>
<li>Next, click on "Format" -&gt; "Change Surface Format...", choose "Four CC 4-bit: DXT1" and hit OK.</li>
<li>Now you can save the file as a .dds file</li>
</ul>
<h1>Converting the model to thModel </h1>
<p>For this section, we are assuming that you exported a model <code>terrain.fbx</code> from 3ds Max, which has a valid UV mapping, a valid material and an assigned texture of some sort.</p>
<p>First of all, we have to make sure the texture paths in the FBX file are relative to the working directory of the engine, which is the same directory that the <em>data</em> and <em>export</em> folders live in. Open up the <em>terrain.fbx</em> file with your favorite text editor (Notepad++, vim, ...) and search for the string ".dds". This should give you all places where your texture is referenced. The FBX format saves both absolute and relative paths, but you will only have to edit the relative paths, i.e. the <code>RelativeFilename</code> key. If you followed the guide so far, it will look like this:</p>
<div class="fragment"><div class="line">RelativeFilename: <span class="stringliteral">&quot;grass.dds&quot;</span></div>
</div><!-- fragment --><p>which we will change to</p>
<div class="fragment"><div class="line">RelativeFilename: <span class="stringliteral">&quot;.\data\models\grass.dds&quot;</span></div>
</div><!-- fragment --><div class="image">
<img src="ImportRenderGeometry_FBXFile.png" alt="ImportRenderGeometry_FBXFile.png"/>
</div>
<p>Time to actually convert the model. If you haven't already, get the <em>ModelConverter.zip</em> from <a href="ftp://mirror.mi.hdm-stuttgart.de/Gaming/GEP_GPP/Tools/">GEP/GPP Mirror</a>. Extract at least the files <em>ModelConverterD.exe</em>, <em>assimp.dll</em>, and <em>readme.txt</em> to the export folder (which we used throughout this guide). You can ignore the <em>src</em> folder as well as the <em>readme.txt</em>, but the latter one is recommended if you want to check some more options that the model converter offers.</p>
<p>Now that we've extracted the model converter, we will use it to export the FBX file to a thModel file, the format that the engine actually understands. In order to do this, open up a command prompt (e.g. use a Git Bash if you have Git installed or shift-right-click in the export folder -&gt; "Open command window here") and enter the following command:</p>
<div class="fragment"><div class="line">ModelConverterD.exe --includeMissingTextures terrain.fbx</div>
</div><!-- fragment --><div class="image">
<img src="ImportRenderGeometry_ModelConverterCommand.png" alt="ImportRenderGeometry_ModelConverterCommand.png"/>
</div>
<p><em>Note: If the conversion failed, make sure that your model has UV mappings and that you supplied the <code>--includeMissingTextures</code> option to the model converter.</em></p>
<p>If the conversion was successful, you will see a list of stats and the "Press any key to continue . . ." prompt that everyone should be familiar with. The converter places the output files in the same place the input files are located in, so in our case the export folder.</p>
<p>Copy the converted models along with their textures to their designated paths beneath the <code>data/</code> folder, in our case <code>terrain.thModel</code> and <code>grass.dds</code> are copied to the directory <code>data/models/</code>.</p>
<h1><a class="anchor" id="ImportRenderGeometry_InGame"></a>
Seeing the Terrain in-game </h1>
<p>In this short section, we will create a small script that creates a game object with a render component. For more details about the render component, see <a class="el" href="md__documents__g_p_p__documentation__game_objects.html#RenderComponent">Render Component </a>.</p>
<p>Create an empty script <code>data/scripts/terrain_test.lua</code> and make it look like the following:</p>
<div class="fragment"><div class="line">include(<span class="stringliteral">&quot;defaults/physicsWorld.lua&quot;</span>)</div>
<div class="line">include(&quot;defaults/freeCamera.lua&quot;)</div>
<div class="line">include(&quot;defaults/stateMachine.lua&quot;)</div>
<div class="line"></div>
<div class="line">local terrain = GameObjectManager:createGameObject(&quot;terrain&quot;)</div>
<div class="line">terrain.renderComponent = terrain:createRenderComponent()</div>
<div class="line">terrain.renderComponent:setPath(&quot;data/models/terrain.thModel&quot;)</div>
</div><!-- fragment --><p>Don't forget to edit <code>data/base/initialize.lua</code> and include your new script there as the main script. When you start the game now, you should see your terrain in the origin of the scene!</p>
<div class="image">
<img src="ImportRenderGeometry_InGameTerrain.png" alt="ImportRenderGeometry_InGameTerrain.png"/>
</div>
<p>If you are interested in generating collision geometry from this terrain, head over to <a class="el" href="_import_collision_geometry.html">Importing Collision Geometry</a>. In any case, enjoy the following, which was included for the lulz:</p>
<div class="image">
<img src="Derp.png" alt="Derp.png"/>
</div>
 </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 25 2014 15:16:19 for Gameplay Programming by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
