<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Gameplay Programming: Importing Collision Geometry</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Gameplay Programming
   </div>
   <div id="projectbrief">Engine Usage Guide and API Documentation for the lecture 113522a &quot;Gameplay Programming&quot;, Stuttgart Media University.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Importing Collision Geometry </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ImportCollisionGeometry_Notes"></a>
General Notes </h1>
<ul>
<li>In order to export your geometry as a havok collision shape, you have to use the Havok Content Tools which are only available for 3ds Max</li>
<li>In 3ds Max, make sure that you use <b>Generic Units</b> in "Customize -&gt; Units Setup...", otherwise you will get weird scales.<ul>
<li><em>Note: Do <b>not</b> use meters!</em></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="ImportCollisionGeometry_Requirements"></a>
Requirements</h1>
<p>Basically the same as in <a class="el" href="_import_render_geometry.html#ImportRenderGeometry_Requirements">requirements for importing render geometry</a> except that you will also need the <em>Havok Content Tools</em>. You can find them on the havok download page or in the <a href="ftp://mirror.mi.hdm-stuttgart.de/Gaming/GEP_GPP/Tools/">GEP/GPP Mirror</a>. This implies that you <b>MUST use 3ds Max</b> (or Maya, but we can't help you with that) since the havok content tools are only provided for 3ds Max (or Maya).</p>
<h1><a class="anchor" id="ImportCollisionGeometry_Guide"></a>
Guide </h1>
<p>We will start off where we ended in the <a class="el" href="_import_render_geometry.html">Importing Rendering Geometry</a> guide so we assume that you have a working terrain model in 3ds Max format (<code>terrain.max</code>) and a script where you tested it in (<code>terrain_test.lua</code>).</p>
<p>With the Havok Content Tools installed, open <code>terrain.max</code> using 3ds Max. Select the terrain object in the scene and navigate to and click on the following option in the top-level menu</p>
<div class="fragment"><div class="line">Havok Content Tools -&gt; Physics -&gt; Create Rigid Body</div>
</div><!-- fragment --><div class="image">
<img src="ImportCollisionGeometry_CreateRigidBody.png" alt="ImportCollisionGeometry_CreateRigidBody.png"/>
</div>
<p>The havok content tools will now have added two new modifiers to the modifier list of your object, namely <code>Shape</code> and <code>Rigid Body</code>. Select the new <code>Shape</code> modifier and choose the correct <code>Shape Type</code>. For our terrain, we choose the shape type <code>Mesh</code>, because it is a non-convex (concave) object and cannot be accurately approximated using any of the standard primitives.</p>
<div class="image">
<img src="ImportCollisionGeometry_ShapeType.png" alt="ImportCollisionGeometry_ShapeType.png"/>
</div>
<p><em>Note: You could choose the <code>Rigid Body</code> modifier now and change some settings there as well, but GEP/GPP does not support loading of rigid bodies as such yet. All GEP/GPP can load for now is a havok shape, i.e. collision geometry</em></p>
<p>Next up, navigate to and click on</p>
<div class="fragment"><div class="line">Havok Content Tools -&gt; Export</div>
</div><!-- fragment --><div class="image">
<img src="ImportCollisionGeometry_ExportButton.png" alt="ImportCollisionGeometry_ExportButton.png"/>
</div>
<p>On most machines, this will take a while (~2 minutes) so go make yourself a coffee or a tea and wait until the havok opens up their export window. You could also browse <a href="http://soup.io">http://soup.io</a> or <a href="http://9gag.com,">http://9gag.com,</a> but that's probably going to consume a lot more than just 2 minutes...</p>
<p>Once the Export window is open, you might see some warnings in the log window on the bottom but you can ignore them for now.</p>
<p><em>Note: In general, you should never just ignore a warning. It is better to fix the issue or disable the warning if possible. They are usually there for a reason.</em></p>
<p>What we are going to do now is populating the "Configuration Set" (in the center at the top of the window) with some of the filters from the "Available Filters" section (top-left of the window). Keep in mind that the order, in which the filters are sorted in the "Configuration Set", is important.</p>
<p>First, in the "Available Filters" section, go to the "Physics" tab. Select the filter "[Physics 2012] Create Rigid Bodies" and click on the "Add &gt;&gt;" button. On the right-hand side of the window, in the filter options, make sure the "Mesh Shape Type" is set to "BV compressed Mesh Shape" and ignore the other options.</p>
<div class="image">
<img src="ImportCollisionGeometry_PhysicsFilter.png" alt="ImportCollisionGeometry_PhysicsFilter.png"/>
</div>
<p>Next, in the "Available Filters" section, go to the "Core" tab. Select the filter "Write to Platform" and click on the "Add &gt;&gt;" button, just like before. On the right-hand side have to adjust some of the filter options.</p>
<p>In the "Format" section, you have to make sure the "Binary" and the "Packfile" options are set. By default, "Binary" is already selected, but "Packfile" is not.</p>
<p>The "Filename" is relative to the current .max file, so in our case we set to "`../data/collision/terrain.hkx`". You could also click on the "..." button and use the "Save File" prompt.</p>
<p>The other options are not important for us.</p>
<div class="image">
<img src="ImportCollisionGeometry_WriteToPlatform.png" alt="ImportCollisionGeometry_WriteToPlatform.png"/>
</div>
<p>So far so good. The last thing to do for the actual export is to hit "Run configuration". But before you do, it is important that the filters in the "Configuration Set" are in the correct order, so make so make sure the physics filter comes first, then the core filter.</p>
<p>Now hit the "Run Configuration" button and watch the export happen.</p>
<div class="image">
<img src="ImportCollisionGeometry_ExportLog.png" alt="ImportCollisionGeometry_ExportLog.png"/>
</div>
<p>Alright! All that is left to do is use the collision from a Lua script. Check the next section on how to do this.</p>
<h1>Loading Collision Geometry from Lua </h1>
<p>We will base our script on the one used in <a class="el" href="_import_render_geometry.html#ImportRenderGeometry_InGame">Seeing the Terrain in-game </a> of the render geometry import guide and make it look like this:</p>
<div class="fragment"><div class="line">include(<span class="stringliteral">&quot;defaults/physicsWorld.lua&quot;</span>)</div>
<div class="line">include(&quot;defaults/freeCamera.lua&quot;)</div>
<div class="line">include(&quot;defaults/stateMachine.lua&quot;)</div>
<div class="line"></div>
<div class="line">local terrain = GameObjectManager:createGameObject(&quot;terrain&quot;)</div>
<div class="line">terrain.renderComponent = terrain:createRenderComponent()</div>
<div class="line">terrain.renderComponent:setPath(&quot;data/models/terrain.thModel&quot;)</div>
<div class="line"></div>
<div class="line">-- The part above is from the &quot;importing render geometry&quot; guide</div>
<div class="line"></div>
<div class="line">-- Make sure we will see the terrain</div>
<div class="line">PhysicsSystem:setDebugDrawingEnabled(true)</div>
<div class="line"></div>
<div class="line">-- Create a physics component</div>
<div class="line">terrain.physicsComponent = terrain:createPhysicsComponent()</div>
<div class="line"></div>
<div class="line">-- Create a rigid body using our externally created collision mesh</div>
<div class="line">local cinfo = RigidBodyCInfo()</div>
<div class="line">cinfo.motionType = MotionType.Fixed -- The terrain is fixed (static), of course</div>
<div class="line">cinfo.shape = PhysicsFactory:loadCollisionMesh(&quot;data/collision/terrain.hkx&quot;)</div>
<div class="line">terrain.rigidBody = terrain.physicsComponent:createRigidBody(cinfo)</div>
</div><!-- fragment --><p>Start the game now and you will see the wireframe of the collision mesh drawn on top of the terrain!</p>
<p>Now to actually test if the collision geometry was set up correctly, we will create a dynamic rigid body and spawn it on top of the terrain. Since this is a dynamic body, it would be a good idea to have some forces acting so we actually see something happening in the physics world, so we create the world manually (instead of using the default) and set the gravity vector as well. The complete script then looks like this:</p>
<div class="fragment"><div class="line">include(<span class="stringliteral">&quot;defaults/freeCamera.lua&quot;</span>)</div>
<div class="line">include(&quot;defaults/stateMachine.lua&quot;)</div>
<div class="line"></div>
<div class="line">do -- Physics world</div>
<div class="line">    local cinfo = WorldCInfo()</div>
<div class="line">    cinfo.gravity = Vec3(0, 0, -9.81)</div>
<div class="line">    physicsWorld = PhysicsFactory:createWorld(cinfo)</div>
<div class="line">    PhysicsSystem:setWorld(physicsWorld)</div>
<div class="line">end</div>
<div class="line"></div>
<div class="line">-- Make sure we will see the terrain</div>
<div class="line">PhysicsSystem:setDebugDrawingEnabled(true)</div>
<div class="line"></div>
<div class="line">local terrain = GameObjectManager:createGameObject(&quot;terrain&quot;)</div>
<div class="line">terrain.renderComponent = terrain:createRenderComponent()</div>
<div class="line">terrain.renderComponent:setPath(&quot;data/models/terrain.thModel&quot;)</div>
<div class="line"></div>
<div class="line">-- The part above is from the &quot;importing render geometry&quot; guide</div>
<div class="line"></div>
<div class="line">-- Create a physics component</div>
<div class="line">terrain.physicsComponent = terrain:createPhysicsComponent()</div>
<div class="line"></div>
<div class="line">-- Create a rigid body using our externally created collision mesh</div>
<div class="line">local cinfo = RigidBodyCInfo()</div>
<div class="line">cinfo.motionType = MotionType.Fixed -- The terrain is fixed (static), of course</div>
<div class="line">cinfo.shape = PhysicsFactory:loadCollisionMesh(&quot;data/collision/terrain.hkx&quot;)</div>
<div class="line">terrain.rigidBody = terrain.physicsComponent:createRigidBody(cinfo)</div>
<div class="line"></div>
<div class="line">local ball = GameObjectManager:createGameObject(&quot;ball&quot;)</div>
<div class="line">ball.physicsComponent = ball:createPhysicsComponent()</div>
<div class="line">local cinfo = RigidBodyCInfo()</div>
<div class="line">cinfo.motionType = MotionType.Dynamic</div>
<div class="line">cinfo.shape = PhysicsFactory:createSphere(1.0) -- 1x1x1 meters</div>
<div class="line">cinfo.mass = 1</div>
<div class="line">cinfo.position = Vec3(0.0, 9.0, 3.0) -- Spawn the ball somewhere on the slope</div>
<div class="line">ball.rigidBody = ball.physicsComponent:createRigidBody(cinfo)</div>
</div><!-- fragment --><p>When you start the game, you should see a rather big ball rolling up and down the half-pipe like terrain! </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Nov 25 2014 15:16:18 for Gameplay Programming by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
